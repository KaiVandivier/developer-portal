(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{109:function(e,t,o){"use strict";o.d(t,"a",(function(){return h})),o.d(t,"b",(function(){return b}));var a=o(0),n=o.n(a);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=n.a.createContext({}),p=function(e){var t=n.a.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},h=function(e){var t=p(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=n.a.forwardRef((function(e,t){var o=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),h=p(o),d=a,b=h["".concat(r,".").concat(d)]||h[d]||u[d]||i;return o?n.a.createElement(b,s(s({ref:t},l),{},{components:o})):n.a.createElement(b,s({ref:t},l))}));function b(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=o.length,r=new Array(i);r[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<i;l++)r[l]=o[l];return n.a.createElement.apply(null,r)}return n.a.createElement.apply(null,o)}d.displayName="MDXCreateElement"},78:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return r})),o.d(t,"metadata",(function(){return s})),o.d(t,"toc",(function(){return c})),o.d(t,"default",(function(){return p}));var a=o(3),n=o(7),i=(o(0),o(109)),r={slug:"cross-origin-cookies",title:"SameSite Cookie Policies and DHIS2 Applications",author:"Austin McGee",author_url:"https://github.com/amcgee",author_image_url:"https://avatars.githubusercontent.com/u/947888?s=400&u=2051953d3237171aee830b7b3ee266a10995dcb2&v=4",tags:["app platform","developer tools","webapp","troubleshooting","authentication"]},s={permalink:"/dev-portal-demo/blog/cross-origin-cookies",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2020-08-10-cross-origin-cookies.md",source:"@site/blog/2020-08-10-cross-origin-cookies.md",description:"As of mid-July 2020, the Chrome (and Chromium) stable release channel has started to disable cross-site cookies by default. Mozilla Firefox has pushed this change to their beta channel and will likely release it to the stable channel soon. This change affects any DHIS2 application running on a different domain than the DHIS2 server instance, including applications running on localhost in development. It does not affect cross-site API requests which use Basic or OAuth authentication headers, as those do not rely on cookies for authentication.",date:"2020-08-10T00:00:00.000Z",tags:[{label:"app platform",permalink:"/dev-portal-demo/blog/tags/app-platform"},{label:"developer tools",permalink:"/dev-portal-demo/blog/tags/developer-tools"},{label:"webapp",permalink:"/dev-portal-demo/blog/tags/webapp"},{label:"troubleshooting",permalink:"/dev-portal-demo/blog/tags/troubleshooting"},{label:"authentication",permalink:"/dev-portal-demo/blog/tags/authentication"}],title:"SameSite Cookie Policies and DHIS2 Applications",readingTime:4.46,truncated:!0,nextItem:{title:"ui 5 release",permalink:"/dev-portal-demo/blog/ui-5-release"}},c=[{value:"What is the SameSite Cookie attribute?",id:"what-is-the-samesite-cookie-attribute",children:[]},{value:"How does this affect DHIS2?",id:"how-does-this-affect-dhis2",children:[]},{value:"How can I work around this for application development?",id:"how-can-i-work-around-this-for-application-development",children:[{value:"Using a local DHIS2 instance",id:"using-a-local-dhis2-instance",children:[]},{value:"In Google Chrome or Chromium-based browsers",id:"in-google-chrome-or-chromium-based-browsers",children:[]},{value:"In Mozilla Firefox",id:"in-mozilla-firefox",children:[]}]},{value:"How can I work around this for production applications running on a separate domain?",id:"how-can-i-work-around-this-for-production-applications-running-on-a-separate-domain",children:[]},{value:"Will the DHIS2 Core address this long-term?",id:"will-the-dhis2-core-address-this-long-term",children:[]}],l={toc:c};function p(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},l,o,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"As of mid-July 2020, the Chrome (and Chromium) stable release channel ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.chromium.org/updates/same-site"}),"has started to disable cross-site cookies by default"),". Mozilla Firefox has pushed this change to their ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://hacks.mozilla.org/2020/08/changes-to-samesite-cookie-behavior/"}),"beta channel and will likely release it to the stable channel soon"),". This change affects any DHIS2 application running ",Object(i.b)("strong",{parentName:"p"},"on a different domain than the DHIS2 server instance"),", including applications running on localhost in development. It does not affect cross-site API requests which use Basic or OAuth authentication headers, as those do not rely on cookies for authentication."),Object(i.b)("h2",{id:"what-is-the-samesite-cookie-attribute"},"What is the SameSite Cookie attribute?"),Object(i.b)("p",null,"Basically, browsers are starting to block, by default, most cookies (which typically contain sensitive information such as login session tokens) to a domain which does not match the current URL of the site visited in the browser. The SERVER (not the browser) must set a specific attribute on the cookie (called ",Object(i.b)("inlineCode",{parentName:"p"},"SameSite")," to have the value ",Object(i.b)("inlineCode",{parentName:"p"},"None"),") if the cookie is safe to include in cross-domain requests. The attribute ",Object(i.b)("inlineCode",{parentName:"p"},"Secure"),", which requires that the cookie only be sent over encrypted HTTPS connections, MUST also be set on the Cookie because ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://web.dev/samesite-cookies-explained/#samesitenone-must-be-secure"}),"it is now required for ",Object(i.b)("inlineCode",{parentName:"a"},"SameSite=None")," cookies"),". DHIS2 does not set these attributes on its authentication cookies. As of mid-July, popular browsers like Chrome and Firefox are beginning to enforce these rules."),Object(i.b)("p",null,"Confused? ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://web.dev/samesite-cookies-explained/"}),"Learn more here")),Object(i.b)("h2",{id:"how-does-this-affect-dhis2"},"How does this affect DHIS2?"),Object(i.b)("p",null,"The vast majority of DHIS2 users and implementers will not be affected by this issue. DHIS2 applications which are directly installed into a DHIS2 instance (either core applications or custom ones installed through the App Management app) will continue to work without any interruptions."),Object(i.b)("p",null,"However, applications running on ",Object(i.b)("strong",{parentName:"p"},"another server under a different domain")," will stop functioning in browsers which implement this new security feature. The most common place this occurs is during application development when your local application (running at ",Object(i.b)("inlineCode",{parentName:"p"},"http://localhost:3000"),", for instance) attempts to connect and authenticate with a remote DHIS2 server (running at ",Object(i.b)("inlineCode",{parentName:"p"},"https://dhis2.myorg.com"),", for instance). When this happens, authentication will fail and the developer will see repeated HTTP 401 (",Object(i.b)("inlineCode",{parentName:"p"},"Error: Unauthorized"),") errors in the developer console. A warning will also appear, at least in Chrome, similar to the following (it also appears in older versions ",Object(i.b)("strong",{parentName:"p"},"which do not yet implement the feature"),"):"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"A cookie associated with a cross-site resource at ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"http://dhis2.org/"}),"http://dhis2.org/")," was set without the ",Object(i.b)("inlineCode",{parentName:"p"},"SameSite")," attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are set with ",Object(i.b)("inlineCode",{parentName:"p"},"SameSite=None")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secure"),". You can review cookies in developer tools under Application>Storage>Cookies and see more details at ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.chromestatus.com/feature/5088147346030592"}),"https://www.chromestatus.com/feature/5088147346030592")," and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.chromestatus.com/feature/5633521622188032"}),"https://www.chromestatus.com/feature/5633521622188032"),".")),Object(i.b)("p",null,"In very rare cases, a production DHIS2 application might be running on a different domain than the DHIS2 server. If this issue is affecting a production application in your environment ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://jira.dhis2.org"}),"please let us know as soon as possible by opening a Jira ticket!")),Object(i.b)("h2",{id:"how-can-i-work-around-this-for-application-development"},"How can I work around this for application development?"),Object(i.b)("h3",{id:"using-a-local-dhis2-instance"},"Using a local DHIS2 instance"),Object(i.b)("p",null,"By far the most secure way to work around this issue during application development is to run a local instance of DHIS2 against which you can test your application. You can easily spin up one or more DHIS2 instances locally using Docker and the ",Object(i.b)("inlineCode",{parentName:"p"},"d2 cluster")," command of the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://cli.dhis2.nu/#/commands/d2-cluster"}),"DHIS2 CLI")),Object(i.b)("h3",{id:"in-google-chrome-or-chromium-based-browsers"},"In Google Chrome or Chromium-based browsers"),Object(i.b)("p",null,'It is possible to disable the default SameSite=Lax behavior in Chrome and Chromium by setting the "SameSite by default cookies" flag (chrome://flags/#same-site-by-default-cookies) to ',Object(i.b)("strong",{parentName:"p"},"Disabled"),". Note that this disables legitimate security behaviors in your browser, so proceed with caution! We recommend that you only disable this flag when actively debugging a DHIS2 application"),Object(i.b)("h3",{id:"in-mozilla-firefox"},"In Mozilla Firefox"),Object(i.b)("p",null,"Firefox stable channel does not yet enforce this cookie policy, so for the moment everything should continue to work. Currently there doesn't appear to be an easy way to disable the policy in Firefox Beta. Stay tuned for updates, and if you find a workaround please share it in the comments below!"),Object(i.b)("h2",{id:"how-can-i-work-around-this-for-production-applications-running-on-a-separate-domain"},"How can I work around this for production applications running on a separate domain?"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"NOTE")," Applications installed directly on a DHIS2 application (using the DHIS2 App Management app) will be available on the same domain as the DHIS2 instance, and so ",Object(i.b)("strong",{parentName:"p"},"are not affected by this issue"))),Object(i.b)("p",null,"If a production application is hosted on a separate server and domain than the DHIS2 instance, and it uses cookies for authentication (the most common setup), it ",Object(i.b)("strong",{parentName:"p"},"will be affected")," by this issue. In order to restore funtionality to external applications it is necessary to set the ",Object(i.b)("inlineCode",{parentName:"p"},"SameSite=None; Secure")," attributes on the DHIS2 authentication cookie and to run the DHIS2 instance with SSL/TLS enabled (so that it is only accessible over HTTPS). DHIS2 does not currently support this behavior by default, so it is necessary to modify the server's cookie responses in a gateway such as NGINX or Apache.  If you are hosting a production application outside of your DHIS2 instance and affected by this issue ",Object(i.b)("strong",{parentName:"p"},"please reach out to the DHIS2 core team so that we can be made aware of use-cases and can help you work around the issue with a gateway setup")),Object(i.b)("h2",{id:"will-the-dhis2-core-address-this-long-term"},"Will the DHIS2 Core address this long-term?"),Object(i.b)("p",null,"In short, we aren't sure if or how we will change the default behavior or DHIS2 cookie authentication yet. We are evaluating options for secure cross-domain authentication and simplified application development workflows, and will share more when we have more information."))}p.isMDXComponent=!0}}]);